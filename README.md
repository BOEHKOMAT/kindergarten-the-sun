# kindergarten-the-sun

GitHub: https://github.com/BOEHKOMAT/kindergarten-the-sun/tree/master

### Опис проекту:
Згідно теми проекту створив:
##### Ролі та Профайли:
- Teacher
- Manager
##### Основні моделі об‘єктів:
- Teacher
- Kid
- Parent
##### Допоміжні кастомні:
- Visit
- Group
##### Використав стандартні:
- Cases
- Reports

Основні сутності - це Вчитель Дитина Батько (Teacher, Kid, Parent Record types of Contact).

*Teacher* - це Юзер з профілем та роллю Teacher і відповідним рекордом типу Teacher прив‘язаним до цього Юзера. До Юзера, за наявності, приєднується група вказана у його відповідному рекорді.<br/>
*Kid* - це Дитина. Особливості: має поля Батька та Групи.<br/>
*Parent* - це відповідно хтось із Батьків.<br/>

Ролі та відповідні профайли *Manager* i *Teacher* та надаються юзерам при створенні.

*Teacher* - Юзер з таким профілем та роллю має доступ Лише до своєї Групи, відповідних їй Дітей, їх Батьків та Відвідуваність(Візити). Створювати Вчитель може тільки Візити, також редагувати їх для указання з ким Дитина прийшла. Працює Вчитель на сторінці своєї Групи, за наявності такої.

Решту клопоту щодо адміністрування бере на себе Менеджер.<br/>
*Manager* - Юзер з таким профілем та роллю має доступ до усього та може змінювати усе (наприклад: переходи Дітей/Вчителів між Групами, редагування інформації рекордів тощо). Також менеджеру доступні усі Cases, у яких вказуються проблеми (згідно теми наявною проблемою може виникнути лише відсутність дитини). Reports створенні для моніторингу Відвідуваності Дітей (по місяцях/ тижнях).

Левову частку бізнес логіки становить зміна та/або передавання прав (надання доступу) на рекорд залежно від дії. 
Доступ до тих чи інших рекордів для кожного Вчителя реалізовано за допомогою:
- ієрархії ролей (Менеджер бачить УСІ записи, оскільки він "вище" Вчителя) 
- OWD Private для Kid(Contact), Visit i Group (Вчитель матиме доступ лише до тих Дітей Групи і Візитів, власником яких він являється)
- Profiles (уже було вище згадано у описі роллі та профайлу)
- Manual Sharing (пов'язано з Батьками, адже у Батьків може бути декілька дітей в різних групах, тому і декілька Вчителів мають мати доступ до Батька)
Так чи інакше усі сутності тісно пов'язані між собою тому при зміні власника у однієї треба змінювати і у релевантних рекордів. Вручну Менеджер загнеться) це робити, тому вся логіка Шерінгу реалізована у flows.

### Список класів та тригерів:
- ```ContactTrigger(ContactTriggerHandler)``` - перевіряє чи достатньо місця у Групі, яку присвоюються Дитині; якщо Групі присвоюють Вчителя, перевіряє чи його у групи уже є Вчитель.
- ```VisitTrigger(VisitTriggerHandler)``` - перевіряє чи уже відмічали сьогодні конкретну Дитину
- ```GroupController``` - отримує з бази даних рекорди Дітей для конкретної Групи, та тих хто найбільше відвідував садок протягом місяця/тижня також конкретної групи.
- ```ContactTriggerTest```
- ```VisitTriggerTest```
- ```GroupControllerTest```
- ```TestDataFactory```
### Список lwc компонент:
- ```kidsList``` - імплементує lightning-datatable для створення "сторінки журналу" для відмічання _Дітей_ відповідної _Групи_. Використовується на RecordPage _Групи_
- ```topKids``` - показує _Дітей_ відповідної групи, які найбільше відвідували садок протягом місяця/тижня. Використовується аналогічно.
### Список flows:
- ```Set Group Owner``` - коли _Вчитель_ отримує нову групу, то до усіх, релевантних старій групі, рекордів _Дітей_ i _Батьків_ доступ закривається, а для релевантних новій - надається. До покинутої групи, до призначення їй нового вчителя, має доступ лише _Менеджер_.
- ```Set Kid Owner``` - коли _Дитина_ змінює або покидає групу, доступ до неї у відповідних _Вчителів_ змінюється. Якщо просто покидає, то рекорд доступний лише _Менеджеру_.
- ```Set Visit Owner``` - при створенні _Візиту_, робить творця власником рекорду
- ```Parent1 Sharing``` - при зміні _Дитиною_ групи від "старого" _Вчителя_ забирається доступ до _Батьківського_ рекорду і надається "новому" _Вчителю_. Якщо просто покидає групу, то - _Батьківський_ рекорд доступний лише _Менеджеру_.
Також при зміні дитиною _Батька_, доступ до "старого" _Батька_  у _Вчителя_ _Дитини_ забирається, і надається до "нового". Це все за умови відсутності інших _Дітей_ "старого" Батька у групі _Вчителя_
- ```User-Teacher``` - при створенні рекордуВчителя, переносить усі дані вказаного _Юзера_, у відповідні поля, та запобігає їх зміні, поки вказаний даний _Юзер_. При виборі для даного рекорду нового _Юзера_ поля перезапишуться.
- ```Default Account``` - Встановлює для будь якого Contact рекорду Account "Chikago"
- ```Visit owner sharing``` - встановлює доступ до _Візитів_ _Дітей_ конкретної _Групи_ для _Вчителя_, відповідно до покидання/(переходу)  _Дітьми_ чи самим _Вчителями_ (між) _Групами_.
- ```Check The Absents``` - кожного дня о 11:00 перевіряє які діти відсутні, та створює для кожного _Кейс_ з проблемою та надсилає лист _Батьку_. (Я відключив надсилання листа через обмеження, але при дебагу все працює - листи надсилав собі на пошту)

